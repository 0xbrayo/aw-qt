language: python
matrix:
  include:
  - python: "3.5"
  - python: "nightly"
  - os: osx
    language: generic
  allow_failures:
  - python: "nightly"

before_install:
 - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
     wget https://github.com/ActivityWatch/activitywatch/raw/master/scripts/ci/setup_venv_osx.sh;
     chmod +x setup_venv_osx.sh;
     ./setup_venv_osx.sh
     source venv/bin/activate;
   fi
   # We might want to move this into the integration test script
 - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
     export DISPLAY=:99.0;
     sh -e /etc/init.d/xvfb start;
     sleep 3;
   fi
 - pip install --upgrade pip
 - pip install pyinstaller
   # Installing PyQt5 with brew was suggested here: https://www.davidculley.com/installing-python-on-a-mac/
   # Installing it with pip didn't work very well for me in a lot of cases...
 - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
     brew install qt5;
     brew install sip --with-python3;
     brew install pyqt5;
   fi

install:
 - make build

script:
 - make test
 - make test-integration
 - make package

